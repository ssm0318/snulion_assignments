<h1>Feed Page</h1>
<a href='/feeds/new'>New Feed</a>

<% @feeds.each do |f| %>
    <div style='border: 1px solid black; margin: 10px;'>
        <% if f.user == current_user %>
            <a href='/feeds/<%= f.id %>/edit'>Edit</a>
            <a href='/feeds/<%= f.id %>' data-method='DELETE'>Delete</a>
        <% end %>

        <% if f.user != current_user %>
            <% if f.user.followers.include? current_user %>
                <a href="/feeds/<%= f.id %>/follow">Unfollow</a>
            <% else %>
                <a href='/feeds/<%= f.id %>/follow'>Follow</a>
            <% end %>
        <% end %>

        <div>Title: <%= f.title %></div>
        <div>Content: <%= f.content %></div>
        <div>Email: <%= f.user.email %></div>
        <div>Name: <%= f.user.name%></div>
        <div>Number of Comments: <%= f.feed_comments.size %></div>

            <% if f.liking_users.include? current_user %>
                <a href="/feeds/<%= f.id %>/like">Like...NOT!!</a>
            <% else %>
                <a href="/feeds/<%= f.id%>/like">Like</a>
            <% end %>

        <% f.feed_comments.each_with_index do |comment, i| %>
            <div style='border: 3px solid green; margin: 15px;'>
            <% if comment.user == current_user %>
                <a href='/feeds/comments/<%= comment.id%>' data-method='DELETE'>Delete</a>
                <a href='/feeds/comments/<%= comment.id%>/edit' data-method='POST'>Edit</a>
            <% end %>

                <% if comment.id == @comment_edit_id %>
                    <form action='/feeds/<%= comment.id%>/comment_update' method='POST'>
                        Comment: <input type="text" name="content" value = '<%= comment.content%>'>
                        <button class="btn btn-default" type="submit">Confirm Edit</button>
                    </form>
                <% else %>
                    <%= i+1 %>
                    <%= comment.content %><br>
                    Email: <%= comment.user.email %><br>
                    Name: <%= comment.user.name %><br>

                    <% if comment.liking_feed_comment_users.include? current_user %>
                        <a href="/feeds/comments/<%= comment.id %>/like">Like...NOT!!</a>
                    <% else %>
                        <a href="/feeds/comments/<%= comment.id%>/like">Like</a>
                    <% end %>

                    <% comment.feed_replies.each_with_index do |reply, j| %>
                        <div style='border: 2px solid blue; margin: 15px;'>
                        <% if reply.user == current_user %>
                            <a href='/feeds/replies/<%= reply.id%>' data-method='DELETE'>Delete</a>
                        <% end %>
                            <%= j+1 %>
                            <%= reply.content %><br>
                            Email: <%= reply.user.email %><br>
                            Name: <%= reply.user.name %><br>

                            <% if reply.liking_feed_reply_users.include? current_user %>
                                <a href="/feeds/replies/<%= reply.id%>/like">Like...NOT!!</a>
                            <% else %>
                                <a href="/feeds/replies/<%= reply.id%>/like">Like</a>
                            <% end %>
                            
                        </div>    
                    <% end %>
                <% end %>

                <form action='/feeds/<%= comment.id%>/reply_create' method='POST'>
                    Reply: <input type="text" name="content">
                    <button class="btn btn-default" type="submit">Reply</button>
                </form>
            </div>
        <% end %>

        <form action='/feeds/<%= f.id%>/comment_create' method='POST'>
            Comment: <input type="text" name="content">
            <button class="btn btn-default" type="submit">Comment</button>
        </form>
    </div>
<% end %>
